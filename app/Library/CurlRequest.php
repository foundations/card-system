<?php
namespace App\Library; class CurlRequest { private static function curl($spadfef0, $sp76360a = 0, $spbbcf5b = '', &$sp57b59a = '', $spfc203b = array(), $spa2890a = 5) { if (!isset($spfc203b['Accept'])) { $spfc203b['Accept'] = '*/*'; } if (!isset($spfc203b['Referer'])) { $spfc203b['Referer'] = $spadfef0; } if (!isset($spfc203b['Content-Type'])) { $spfc203b['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($spfc203b['User-Agent'])) { $spfc203b['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($sp57b59a != '') { $spfc203b['Cookie'] = $sp57b59a; } $sp705184 = array(); foreach ($spfc203b as $sp39b5d7 => $sp81d540) { $sp705184[] = $sp39b5d7 . ': ' . $sp81d540; } $sp705184[] = 'Expect:'; $spe77a27 = curl_init(); curl_setopt($spe77a27, CURLOPT_URL, $spadfef0); if ($sp76360a == 1) { curl_setopt($spe77a27, CURLOPT_POST, 1); if ($spbbcf5b != '') { curl_setopt($spe77a27, CURLOPT_POSTFIELDS, $spbbcf5b); } } if (defined('MY_PROXY')) { curl_setopt($spe77a27, CURLOPT_PROXY, MY_PROXY); } if (defined('MY_PROXY_PASS')) { curl_setopt($spe77a27, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } curl_setopt($spe77a27, CURLOPT_TIMEOUT, $spa2890a); curl_setopt($spe77a27, CURLOPT_CONNECTTIMEOUT, $spa2890a); curl_setopt($spe77a27, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spe77a27, CURLOPT_HEADER, 1); curl_setopt($spe77a27, CURLOPT_HTTPHEADER, $sp705184); $sp651d08 = curl_exec($spe77a27); $sp4e1b20 = curl_getinfo($spe77a27, CURLINFO_HEADER_SIZE); $spcfb29a = substr($sp651d08, 0, $sp4e1b20); $spd86457 = substr($sp651d08, $sp4e1b20); curl_close($spe77a27); $spfc203b = explode('
', $spcfb29a); $sp2b6f76 = ''; foreach ($spfc203b as $spcfb29a) { if (strpos($spcfb29a, 'Set-Cookie') !== false) { if (strpos($spcfb29a, ';') !== false) { $sp2b6f76 = $sp2b6f76 . trim(Helper::strBetween($spcfb29a, 'Set-Cookie:', ';')) . ';'; } else { $sp2b6f76 = $sp2b6f76 . trim(str_replace('Set-Cookie:', '', $spcfb29a)) . ';'; } } } $sp57b59a = self::combineCookie($sp57b59a, $sp2b6f76); return $spd86457; } public static function get($spadfef0, &$sp57b59a = '', $spfc203b = array(), $spa2890a = 5) { return self::curl($spadfef0, 0, '', $sp57b59a, $spfc203b, $spa2890a); } public static function post($spadfef0, $spbbcf5b = '', &$sp57b59a = '', $spfc203b = array(), $spa2890a = 5) { return self::curl($spadfef0, 1, $spbbcf5b, $sp57b59a, $spfc203b, $spa2890a); } public static function combineCookie($sp2d4519, $spfa582b) { $spe19cf0 = explode(';', $sp2d4519); $spe30e8f = explode(';', $spfa582b); foreach ($spe19cf0 as $sp7c6222) { if (self::cookieIsExists($spe30e8f, self::cookieGetName($sp7c6222)) == false) { array_push($spe30e8f, $sp7c6222); } } $spe95ec8 = ''; foreach ($spe30e8f as $sp7c6222) { if (substr($sp7c6222, -8, 8) != '=deleted' && strlen($sp7c6222) > 1) { $spe95ec8 .= $sp7c6222 . '; '; } } return substr($spe95ec8, 0, strlen($spe95ec8) - 2); } public static function cookieGetName($sp82fa01) { $sp74a832 = strpos($sp82fa01, '='); return substr($sp82fa01, 0, $sp74a832); } public static function cookieGetValue($sp82fa01) { $sp74a832 = strpos($sp82fa01, '='); $sp69e010 = substr($sp82fa01, $sp74a832 + 1, strlen($sp82fa01) - $sp74a832); return $sp69e010; } public static function cookieGet($sp57b59a, $sp3d006c, $spc6c182 = false) { $sp57b59a = str_replace(' ', '', $sp57b59a); if (substr($sp57b59a, -1, 1) != ';') { $sp57b59a = ';' . $sp57b59a . ';'; } else { $sp57b59a = ';' . $sp57b59a; } $spb39012 = Helper::strBetween($sp57b59a, ';' . $sp3d006c . '=', ';'); if (!$spc6c182 || $spb39012 == '') { return $spb39012; } else { return $sp3d006c . '=' . $spb39012; } } private static function cookieIsExists($sp058728, $spa68f6c) { foreach ($sp058728 as $sp7c6222) { if (self::cookieGetName($sp7c6222) == $spa68f6c) { return true; } } return false; } function test() { $sp69e010 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp69e010); } }