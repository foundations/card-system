<?php
include 'AlipayMobilePublicMultiMediaExecute.php'; class AlipayMobilePublicMultiMediaClient { private $DEFAULT_CHARSET = 'UTF-8'; private $METHOD_POST = 'POST'; private $METHOD_GET = 'GET'; private $SIGN = 'sign'; private $timeout = 10; private $serverUrl; private $appId; private $privateKey; private $prodCode; private $format = 'json'; private $sign_type = 'RSA'; private $charset; private $apiVersion = '1.0'; private $apiMethodName = 'alipay.mobile.public.multimedia.download'; private $media_id = 'L21pZnMvVDFQV3hYWGJKWFhYYUNucHJYP3Q9YW13ZiZ4c2lnPTU0MzRhYjg1ZTZjNWJmZTMxZGJiNjIzNDdjMzFkNzkw575'; private $connectTimeout = 3000; private $readTimeout = 15000; function __construct($sp62d69d = '', $spe46804 = '', $sp99fea1 = '', $sp5e1fb8 = '', $sp9d5b1a = 'GBK') { $this->serverUrl = $sp62d69d; $this->appId = $spe46804; $this->privateKey = $sp99fea1; $this->format = $sp5e1fb8; $this->charset = $sp9d5b1a; } public function getContents() { $spa16b85 = array('app_id' => $this->appId, 'method' => $this->METHOD_POST, 'sign_type' => $this->sign_type, 'version' => $this->apiVersion, 'timestamp' => date('Y-m-d H:i:s'), 'biz_content' => '{"mediaId":"' . $this->media_id . '"}', 'charset' => $this->charset); $sp1872cb = $this->buildGetUrl($spa16b85); $spbbcf5b = $sp1872cb; $spe77a27 = curl_init(); curl_setopt($spe77a27, CURLOPT_URL, $this->serverUrl); curl_setopt($spe77a27, CURLOPT_HEADER, TRUE); curl_setopt($spe77a27, CURLOPT_RETURNTRANSFER, 1); curl_setopt($spe77a27, CURLOPT_TIMEOUT, $this->timeout); if ($this->METHOD_POST == 'POST') { curl_setopt($spe77a27, CURLOPT_POST, 1); curl_setopt($spe77a27, CURLOPT_POSTFIELDS, $spbbcf5b); } $sp31437a = curl_exec($spe77a27); $sp5841a2 = curl_getinfo($spe77a27, CURLINFO_HTTP_CODE); curl_close($spe77a27); echo $sp31437a; $spa16b85 = explode('

', $sp31437a, 2); $spcfb29a = $spa16b85[0]; if ($sp5841a2 == '200') { $spd86457 = $spa16b85[1]; } else { $spd86457 = ''; } return $this->execute($spcfb29a, $spd86457, $sp5841a2); } public function execute($spcfb29a = '', $spd86457 = '', $sp5841a2 = '') { $spb3c6b5 = new AlipayMobilePublicMultiMediaExecute($spcfb29a, $spd86457, $sp5841a2); return $spb3c6b5; } public function buildGetUrl($sp4f4bed = array()) { if (!is_array($sp4f4bed)) { } $sp2bb3bd = $this->buildQuery($sp4f4bed); $sp5c4a3a = ''; $sp67e25d = 64; $spbdffa0 = $this->privateKey; $sp6cfd21 = array(); if (!stripos($spbdffa0, '
')) { $sp3f53b5 = 0; while ($spb78a90 = substr($spbdffa0, $sp3f53b5 * $sp67e25d, $sp67e25d)) { $sp6cfd21[] = $spb78a90; $sp3f53b5++; } } else { } $spbdffa0 = '-----BEGIN RSA PRIVATE KEY-----
' . implode('
', $sp6cfd21); $spbdffa0 = $spbdffa0 . '
-----END RSA PRIVATE KEY-----'; $spc2bcd8 = openssl_pkey_get_private($spbdffa0, $sp5c4a3a); $spf9f124 = ''; if ('RSA2' == $this->sign_type) { openssl_sign($sp2bb3bd, $spf9f124, $spc2bcd8, OPENSSL_ALGO_SHA256); } else { openssl_sign($sp2bb3bd, $spf9f124, $spc2bcd8, OPENSSL_ALGO_SHA1); } openssl_free_key($spc2bcd8); $spf9f124 = base64_encode($spf9f124); $spf9f124 = urlencode($spf9f124); $sp516cf0 = $sp2bb3bd . '&' . $this->SIGN . '=' . $spf9f124; return $sp516cf0; } public function buildQuery($sp4f4bed) { if (!$sp4f4bed) { return null; } ksort($sp4f4bed); $sp636f0e = array(); foreach ($sp4f4bed as $spc95936 => $sp4d089d) { $sp636f0e[] = $spc95936 . '=' . $sp4d089d; } $sp2bb3bd = implode('&', $sp636f0e); return $sp2bb3bd; } }