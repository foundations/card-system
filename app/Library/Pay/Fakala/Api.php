<?php
namespace App\Library\Pay\Fakala; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; private $pay_id; public function __construct($sp7a2170) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $sp7a2170; $this->url_return = SYS_URL . '/pay/return/' . $sp7a2170; $this->pay_id = $sp7a2170; } function goPay($sp54f11a, $spd2bbfa, $sp942f8c, $spd86457, $sp5f71a2) { if (!isset($sp54f11a['gateway'])) { throw new \Exception('请填写gateway'); } if (!isset($sp54f11a['api_id'])) { throw new \Exception('请填写api_id'); } if (!isset($sp54f11a['api_key'])) { throw new \Exception('请填写api_key'); } include_once 'sdk.php'; $sp45d57c = new \fakala($sp54f11a['gateway'], $sp54f11a['api_id'], $sp54f11a['api_key']); $sp286f3b = strtolower($sp54f11a['payway']); $sp45d57c->goPay($sp286f3b, $spd2bbfa, 0, $sp5f71a2, '', $this->url_return, $this->url_notify); } function verify($sp54f11a, $sp0a40c9) { $sp60916b = isset($sp54f11a['isNotify']) && $sp54f11a['isNotify']; include_once 'sdk.php'; $sp45d57c = new \fakala($sp54f11a['gateway'], $sp54f11a['api_id'], $sp54f11a['api_key']); if ($sp60916b) { $spfe67da = $sp45d57c->notify_verify(); } else { $spfe67da = $sp45d57c->return_verify(); } if ($spfe67da) { $spd2bbfa = $_REQUEST['out_trade_no']; $sp151a84 = $_REQUEST['total_fee']; $spaa7af4 = $_REQUEST['order_no']; $sp0a40c9($spd2bbfa, $sp151a84, $spaa7af4); } return $spfe67da; } }