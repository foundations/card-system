<?php
namespace App\Library\Pay\Yeke; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; public function __construct($sp7a2170) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $sp7a2170; $this->url_return = SYS_URL . '/pay/return/' . $sp7a2170; } function goPay($sp54f11a, $spd2bbfa, $sp942f8c, $spd86457, $sp5f71a2) { $sp488d84 = sprintf('%.2f', $sp5f71a2 / 100); define('yeke_USER_ID', $sp54f11a['id']); define('yeke_USER_KEY', $sp54f11a['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); $sp8339d0 = strtolower($sp54f11a['payway']); $spb5c3f0 = ''; $sp156ef7 = ''; if ($sp8339d0 == 'alipay' || $sp8339d0 == 'alipay_wap') { $spb5c3f0 = 'alipay'; $sp156ef7 = 'ALIPAY'; } elseif ($sp8339d0 == 'tenpay' || $sp8339d0 == 'tenpay_wap') { $spb5c3f0 = 'tenpay'; $sp156ef7 = 'TENPAY'; } elseif ($sp8339d0 == 'weixin') { $spb5c3f0 = 'weixin'; $sp156ef7 = 'WEIXIN'; } elseif ($sp8339d0 == 'weixin_wap') { $spb5c3f0 = 'wxwap'; $sp156ef7 = 'wxwap'; } elseif ($sp8339d0 == 'qq' || $sp8339d0 == 'qq_wap') { $spb5c3f0 = 'sqzf'; $sp156ef7 = 'sqzf'; } elseif ($sp8339d0 == 'qq_wap') { $spb5c3f0 = 'sqzfqb'; $sp156ef7 = 'sqzfqb'; } require 'yekeApiLib.php'; require 'HttpClient.php'; $sp942f8c = mb_substr($sp942f8c, 0, 50, 'UTF-8'); $spd86457 = mb_substr($spd86457, 0, 100, 'UTF-8'); $sp636f0e = array('P_orderid' => $spd2bbfa, 'P_paymoney' => $sp488d84, 'P_productname' => urlencode($sp942f8c), 'P_productinfo' => urlencode($spd86457), 'P_remark' => urlencode($spd2bbfa), 'P_custom_1' => urlencode($sp156ef7), 'P_custom_2' => '', 'P_contact' => urlencode(SYS_NAME), 'P_paytype' => $spb5c3f0, 'P_gateway' => $sp156ef7, 'P_cardnum' => '', 'P_cardpwd' => '', 'P_cardvalue' => '', 'P_notify_url' => $this->url_notify, 'P_return_url' => $this->url_return . '/' . $spd2bbfa); $sp28957f = new \yekeAPI(); $spfe67da = $sp28957f->payGate($sp636f0e); echo $spfe67da; } function verify($sp54f11a, $sp0a40c9) { $sp60916b = isset($sp54f11a['isNotify']) && $sp54f11a['isNotify']; define('yeke_USER_ID', $sp54f11a['id']); define('yeke_USER_KEY', $sp54f11a['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); require 'HttpClient.php'; require 'yekeApiLib.php'; $sp28957f = new \yekeAPI(); if ($sp60916b) { $spfe67da = $sp28957f->verifyNotify(); } else { $spfe67da = $sp28957f->verifyReturn(); } if ($spfe67da) { $spd0728d = $_REQUEST['P_orderid']; $sp088295 = $_REQUEST['P_api_orderid']; $spff4861 = $_REQUEST['P_money']; if ($_REQUEST['P_status'] == 'SUCCESS') { $sp0a40c9($sp088295, (int) ($spff4861 * 100), $spd0728d); if ($sp60916b) { echo 'success'; } return true; } else { if ($sp60916b) { echo '失败订单'; } } } else { if ($sp60916b) { echo '验证失败'; } } return false; } }