<?php
require_once 'qpayMchUtil.class.php'; class QpayMchAPI { protected $url; protected $isSSL; protected $timeout; public function __construct($spadfef0, $sp841667, $spa2890a = 5) { $this->url = $spadfef0; $this->isSSL = $sp841667; $this->timeout = $spa2890a; } public function notify_params() { $spf87232 = file_get_contents('php://input'); return QpayMchUtil::xmlToArray($spf87232); } public function notify_verify($sp636f0e, $sp54f11a) { if (!isset($sp636f0e['sign'])) { return false; } $spc768dc = QpayMchUtil::getSign($sp636f0e, $sp54f11a['mch_key']); return $spc768dc === $sp636f0e['sign']; } public function req($sp636f0e, $sp54f11a) { $sp27b5c4 = array(); $sp636f0e['mch_id'] = $sp54f11a['mch_id']; $sp636f0e['nonce_str'] = QpayMchUtil::createNoncestr(); $sp636f0e['sign'] = QpayMchUtil::getSign($sp636f0e, $sp54f11a['mch_key']); $spf87232 = QpayMchUtil::arrayToXml($sp636f0e); if (isset($this->isSSL)) { $sp27b5c4 = QpayMchUtil::reqByCurlSSLPost($spf87232, $this->url, $this->timeout); } else { $sp27b5c4 = QpayMchUtil::reqByCurlNormalPost($spf87232, $this->url, $this->timeout); } return $sp27b5c4; } }