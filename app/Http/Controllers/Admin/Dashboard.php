<?php
namespace App\Http\Controllers\Admin; use App\Library\Response; use App\Order; use Illuminate\Http\Request; use App\Http\Controllers\Controller; class Dashboard extends Controller { function index(Request $spceaf29) { $sp2eb9d2 = array('today' => array('count' => 0, 'income' => 0, 'profit' => 0), 'yesterday' => array('count' => 0, 'income' => 0, 'profit' => 0)); $spcefbe0 = Order::whereUserId(\Auth::Id())->whereDate('paid_at', \Carbon\Carbon::now()->toDateString())->where(function ($sp4f4bed) { $sp4f4bed->where('status', Order::STATUS_PAID)->orWhere('status', Order::STATUS_SUCCESS); })->selectRaw('COUNT(*) as `count`,SUM(`income`) as `income`,SUM(`income`-`cost`) as `profit`')->get()->toArray(); $spd2cb6c = Order::whereUserId(\Auth::Id())->whereDate('paid_at', \Carbon\Carbon::yesterday()->toDateString())->where(function ($sp4f4bed) { $sp4f4bed->where('status', Order::STATUS_PAID)->orWhere('status', Order::STATUS_SUCCESS); })->selectRaw('COUNT(*) as `count`,SUM(`income`) as `income`,SUM(`income`-`cost`) as `profit`')->get()->toArray(); if (isset($spcefbe0[0]) && isset($spcefbe0[0]['count'])) { $sp2eb9d2['today'] = array('count' => (int) $spcefbe0[0]['count'], 'income' => (int) $spcefbe0[0]['income'], 'profit' => (int) $spcefbe0[0]['profit']); } if (isset($spd2cb6c[0]) && isset($spd2cb6c[0]['count'])) { $sp2eb9d2['yesterday'] = array('count' => (int) $spd2cb6c[0]['count'], 'income' => (int) $spd2cb6c[0]['income'], 'profit' => (int) $spd2cb6c[0]['profit']); } $sp2eb9d2['need_ship_count'] = Order::whereUserId(\Auth::Id())->where('status', Order::STATUS_PAID)->count(); return Response::success($sp2eb9d2); } function clearCache() { if (function_exists('opcache_reset')) { opcache_reset(); } return Response::success(); } }