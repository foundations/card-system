webpackJsonp([9,29],{"5UwD":function(t,e,i){"use strict";var n,a,s,l,o,r,c,h,d,u,p,f;Object.defineProperty(e,"__esModule",{value:!0}),n=i("woOf"),a=i.n(n),s=i("Y81h"),l=i.n(s),o=i("GKtG"),r=i("s8Ph"),c=i("UgCr"),h=i("QacQ"),d=i("YF+v"),u={props:{userInfo:{type:Object,default:null},onlyTrashed:{default:!1},_project:{default:"merchant"},filter:{}},components:{cardEdit:h.default,cardAdd:d.default},data:function(){return{loading:!1,exporting:!1,showAddBox:!1,addBoxLoaded:!1,cardType:o.c,cardStatus:o.b,search:{type:"card",value:""},where:{category_id:-1,product_id:-1,onlyCanSell:1},categories:[{id:-2,name:"加载中"}],products:[{id:-2,name:"加载中"}],list:{current_page:1,data:[],from:1,last_page:1,next_page_url:null,per_page:20,prev_page_url:null,to:0,total:0},checkedIds:"",statusFilter:[{text:"未售",value:o.b.STATUS_NORMAL,type:"primary"},{text:"已售",value:o.b.STATUS_SOLD,type:"info"}],statusFilterValue:[],typeFilter:[{text:"重复卖",value:o.c.TYPE_REPEAT,type:"info"},{text:"一次性",value:o.c.TYPE_ONETIME,type:"info"}],editInfo:null}},watch:{loading:function(t,e){t?e||l.a.isStarted()||l.a.start():l.a.done()}},mounted:function(){var t=void 0,e=void 0,i=void 0;this.$route.query.category_id&&this.$route.query.product_id&&this.$route.query.type&&(t=this.$route.query.type,e=parseInt(this.$route.query.category_id),i=parseInt(this.$route.query.product_id)),this.filter&&this.filter.category_id&&this.filter.product_id&&this.filter.type&&(t=this.filter.type,e=parseInt(this.filter.category_id),i=parseInt(this.filter.product_id)),t&&e&&i?this.searchBy_(t,e,i):(this.handleSearch(),this.getCategories())},methods:{searchBy_:function(t,e,i){this.where.category_id=e,this.where.product_id=i,"count"===t?(this.where.onlyCanSell=1,this.statusFilterValue.splice(0,this.statusFilterValue.length),this.where.status=""):"count_sold"===t&&(this.where.onlyCanSell=0,this.statusFilterValue.push(o.b.STATUS_SOLD),this.where.status=this.statusFilterValue.join(",")),this.handleSearch(),this.getCategories()},handleOnlyCanSell:function(){this.where.onlyCanSell&&(this.statusFilterValue.splice(0,this.statusFilterValue.length),this.where.status=""),this.handleSearch()},getCategories:function(){var t,e=this;this.loading=!0,t={search:"simple",val:"list"},this.userInfo&&(t.user_id=this.userInfo.id),Object(r.c)(t).then(function(t){e.categories=t.data,e.where.category_id>0&&e.where.product_id>0&&e.getProducts(e.where.category_id,e.where.product_id)})},getProducts:function(t){var e,i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.where.product_id=n,this.getList(),this.products=[],e={search:"simple",val:t},this.userInfo&&(e.user_id=this.userInfo.id),Object(c.e)(e).then(function(t){i.products=t.data})},_generateWhere:function(){return this.where.current_page=this.list.current_page,this.where.per_page=this.list.per_page,this.where.trashed=this.onlyTrashed,this.userInfo&&(this.where.user_id=this.userInfo.id),this.where},getList:function(){var t=this;this.loading=!0,Object(o.g)(this._generateWhere()).then(function(e){t.list=e.data,t.loading=!1})},handleExport:function(){var t=this;this.exporting||(this.exporting=!0,this.where.current_page=this.list.current_page,this.where.per_page=this.list.per_page,this.where.trashed=this.onlyTrashed,Object(o.f)(this.where).then(function(e){t.$refs.exportFrame.src=window.API_HOST+"card/export/"+e.data,setTimeout(function(){t.exporting=!1},1e3)}).catch(function(){setTimeout(function(){t.exporting=!1},1e3)}))},handleSearch:function(){var t={search:this.search.type,val:this.search.value};a()(this.where,t),this.getList()},handleFilterChange:function(t){var e={};t.status?e.status=t.status.join(","):e.status=null,t.type?e.type=t.type.join(","):e.type=null,a()(this.where,e),this.getList()},onChangePage:function(){this.getList()},onChangePageSize:function(t){this.list.per_page=t,this.getList()},handleDelete:function(t){var e=this,i=t.card;this.$confirm("删除卡密"+i+"? 您可以稍后在回收站查看","提示",{type:"warning"}).then(function(){e.loading=!0,Object(o.h)(t.id).then(function(){e.$notify({title:"操作完成",message:"卡密"+i+"已删除",type:"info"}),e.getList()}).catch(function(){e.loading=!1})})},handleTrashDelete:function(t){var e=this,i=t.card;this.$confirm("销毁卡密"+i+"? 此操作不可恢复","提示",{type:"warning"}).then(function(){e.loading=!0,Object(o.i)(t.id).then(function(){e.$notify({title:"操作完成",message:"卡密"+i+"已销毁",type:"info"}),e.getList()}).catch(function(){e.loading=!1})})},handleRestore:function(t){var e=this,i=t.card;this.$confirm("还原卡密"+i+"? ","提示",{type:"warning"}).then(function(){e.loading=!0,Object(o.j)(t.id).then(function(){e.$notify({title:"操作完成",message:"卡密"+i+"已还原",type:"success"}),e.getList()}).catch(function(){e.loading=!1})})},checkDelete:function(){var t=this;this.checkedIds.length&&this.$confirm("批量删除选中卡密? 您可以稍后在回收站查看","提示",{type:"warning"}).then(function(){t.loading=!0,Object(o.h)(t.checkedIds).then(function(){t.$notify({title:"操作完成",message:"选中卡密已删除",type:"info"}),t.getList()}).catch(function(){t.loading=!1})})},checkTrashDelete:function(){var t=this;this.checkedIds.length&&this.$confirm("批量销毁选中卡密? 此操作不可恢复","提示",{type:"warning"}).then(function(){t.loading=!0,Object(o.i)(t.checkedIds).then(function(){t.$notify({title:"操作完成",message:"选中卡密已销毁",type:"info"}),t.getList()}).catch(function(){t.loading=!1})})},checkRestore:function(){var t=this;this.checkedIds.length&&this.$confirm("批量还原选中卡密? ","提示",{type:"warning"}).then(function(){t.loading=!0,Object(o.j)(t.checkedIds).then(function(){t.$notify({title:"操作完成",message:"选中卡密已还原",type:"success"}),t.getList()}).catch(function(){t.loading=!1})})},handleDeleteAll:function(){var t=this;this.$confirm("是否"+(this.onlyTrashed?"清空当前回收站":"删除当前卡密")+"列表?<br> (当前列表共"+this.list.total+"条)","警告",{type:"warning",dangerouslyUseHTMLString:!0}).then(function(){t.loading=!0,Object(o.d)(t._generateWhere()).then(function(){t.$notify({title:"操作完成",message:t.onlyTrashed?"当前回收站列表已清空":"当前卡密列表已删除",type:"info"}),t.getList()}).catch(function(){t.loading=!1})})},handleRestoreAll:function(){var t=this;this.$confirm("是否还原当前回收站列表?<br> (当前列表共"+this.list.total+"条)","询问",{type:"warning",dangerouslyUseHTMLString:!0}).then(function(){t.loading=!0,Object(o.k)(t._generateWhere()).then(function(){t.$notify({title:"操作完成",message:"当前回收站列表已还原",type:"success"}),t.getList()}).catch(function(){t.loading=!1})})},handleAdd:function(){this.$router.push("/admin/product/card/add")},onAdd:function(){this.getList(),this.showAddBox=!1},handleEdit:function(t){this.editInfo=t},editCallback:function(t){this.editInfo=null,t&&this.getList()}}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"container",class:{"app-container":!t.userInfo}},[i("el-collapse-transition",[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showAddBox,expression:"showAddBox"}],staticClass:"apply-box"},[i("el-button",{staticStyle:{float:"right",margin:"10px 15px"},attrs:{icon:"el-icon-close",size:"small"},on:{click:function(e){t.showAddBox=!1}}}),t._v(" "),t.showAddBox||t.addBoxLoaded?i("el-card",{staticClass:"my-card"},[i("card-add",{attrs:{"in-box":!0,userInfo:t.userInfo},on:{submit:t.onAdd}})],1):t._e()],1)]),t._v(" "),i("el-col",{staticClass:"no-bottom-form",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[i("el-form",{staticClass:"list-pre-table",attrs:{inline:!0}},[i("el-form-item",{staticClass:"mobile-full-width"},[i("el-select",{staticClass:"mobile-full-width",attrs:{size:"small","no-data-text":"无分类数据"},on:{change:t.getProducts},model:{value:t.where.category_id,callback:function(e){t.$set(t.where,"category_id",e)},expression:"where.category_id"}},[i("el-option",{attrs:{label:"全部",value:-1}}),t._v(" "),t._l(t.categories,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})],2),t._v(" "),t.where.category_id>0?i("el-select",{staticClass:"mobile-full-width",attrs:{size:"small"},on:{change:t.getList},model:{value:t.where.product_id,callback:function(e){t.$set(t.where,"product_id",e)},expression:"where.product_id"}},[i("el-option",{attrs:{label:"全部",value:-1}}),t._v(" "),t._l(t.products,function(t){return i("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})})],2):t._e()],1),t._v(" "),i("el-form-item",{staticClass:"mobile-full-width"},[i("el-input",{attrs:{placeholder:"请输入",size:"small"},model:{value:t.search.value,callback:function(e){t.$set(t.search,"value",e)},expression:"search.value"}},[i("el-select",{staticStyle:{width:"90px"},attrs:{slot:"prepend",placeholder:"搜索类型",value:"",size:"small"},slot:"prepend",model:{value:t.search.type,callback:function(e){t.$set(t.search,"type",e)},expression:"search.type"}},[i("el-option",{attrs:{label:"ID",value:"id"}}),t._v(" "),i("el-option",{attrs:{label:"卡号",value:"card"}})],1)],1)],1),t._v(" "),i("el-form-item",{staticClass:"fix-height"},[i("el-button",{attrs:{size:"small"},on:{click:t.handleSearch}},[t._v("搜索")])],1),t._v(" "),i("el-form-item",{staticClass:"fix-height mobile-full-width"},[i("el-switch",{attrs:{"inactive-text":"只显示可售","active-value":1,"inactive-value":0},on:{change:t.handleOnlyCanSell},model:{value:t.where.onlyCanSell,callback:function(e){t.$set(t.where,"onlyCanSell",e)},expression:"where.onlyCanSell"}})],1),t._v(" "),i("el-form-item",{staticStyle:{float:"right","margin-right":"0"}},[i("a",{staticClass:"icon-btn",attrs:{disabled:t.exporting},on:{click:t.handleExport}},[i("icon",{attrs:{name:t.exporting?"spinner":"file-text",pulse:t.exporting}}),t._v(" "+t._s(t.exporting?"导出中":"导出("+t.list.total+")"))],1),t._v(" "),t.onlyTrashed?t._e():i("a",{staticClass:"icon-btn",on:{click:t.handleAdd}},[i("icon",{attrs:{name:"plus"}}),t._v(" 添加")],1),t._v(" "),i("iframe",{ref:"exportFrame",staticStyle:{display:"none",width:"0",height:"0"}})])],1)],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"list-table",attrs:{data:t.list.data,stripe:"",border:""},on:{"filter-change":t.handleFilterChange,"selection-change":function(e){return t.checkedIds=e.map(function(t){return t.id}).join(",")}}},[i("el-table-column",{attrs:{type:"selection",width:"40"}}),t._v(" "),"admin"===t._project?i("el-table-column",{attrs:{prop:"id",label:"ID",width:"70"}}):t._e(),t._v(" "),"admin"!==t._project||t.userInfo?t._e():i("el-table-column",{attrs:{prop:"user_id",label:"商户ID",width:"70"}}),t._v(" "),i("el-table-column",{attrs:{prop:"card",label:"卡密","min-width":"180","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"product",label:"所属商品","min-width":"120","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.product?e.row.product.name:"未知商品#"+e.row.product_id)+"\n      ")]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"type",label:"类型",width:"90","column-key":"type",filters:t.typeFilter,"filter-placement":"bottom"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tag",{attrs:{type:(e.row.type,t.cardType.TYPE_ONETIME,"info"),"close-transition":""}},[t._v("\n          "+t._s(e.row.type===t.cardType.TYPE_ONETIME?"一次性":"重复卖")+"\n        ")])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"status",label:"售出状态",width:"90","column-key":"status",filters:t.statusFilter,"filtered-value":t.statusFilterValue,"filter-placement":"bottom"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.type===t.cardType.TYPE_ONETIME?i("el-tag",{attrs:{type:e.row.status===t.cardStatus.STATUS_SOLD?"info":"primary","close-transition":""}},[t._v("\n          "+t._s(e.row.status===t.cardStatus.STATUS_SOLD?"已售":"未售")+"\n        ")]):i("el-tag",{attrs:{type:e.row.count_sold>0?"info":"primary","close-transition":""}},[t._v("\n          "+t._s(e.row.count_sold+"/"+e.row.count_all)+"\n        ")])]}}])}),t._v(" "),t.onlyTrashed?t._e():i("el-table-column",{attrs:{prop:"created_at",label:"添加时间",width:"150"}}),t._v(" "),t.onlyTrashed?i("el-table-column",{attrs:{prop:"deleted_at",label:"删除时间",width:"150"}}):t._e(),t._v(" "),i("el-table-column",{attrs:{label:"操作",width:t.onlyTrashed?"120":"50",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.onlyTrashed?t._e():i("a",{staticClass:"icon-btn",staticStyle:{"font-size":"14px"},on:{click:function(i){t.handleEdit(e.row)}}},[i("icon",{attrs:{name:"pencil"}})],1),t._v(" "),t.onlyTrashed?t._e():i("a",{staticClass:"icon-btn",on:{click:function(i){t.handleDelete(e.row)}}},[i("icon",{attrs:{name:"trash-o"}})],1),t._v(" "),t.onlyTrashed?i("a",{staticClass:"icon-btn",on:{click:function(i){t.handleTrashDelete(e.row)}}},[i("icon",{attrs:{name:"trash-o"}}),t._v("\n          销毁\n        ")],1):t._e(),t._v(" "),t.onlyTrashed?i("a",{staticClass:"icon-btn",on:{click:function(i){t.handleRestore(e.row)}}},[i("icon",{attrs:{name:"undo"}}),t._v("\n          还原\n        ")],1):t._e()]}}])})],1),t._v(" "),i("el-col",{staticClass:"list-after-action",staticStyle:{"padding-top":"8px","text-align":"left"},attrs:{span:24}},[i("el-form",{staticClass:"no-bottom-form",attrs:{inline:!0}},[i("el-form-item",{attrs:{label:""}},[t.onlyTrashed?t._e():i("el-button",{attrs:{size:"small"},on:{click:t.checkDelete}},[t._v("选中删除")]),t._v(" "),t.onlyTrashed?i("el-button",{attrs:{size:"small"},on:{click:t.checkTrashDelete}},[t._v("选中销毁")]):t._e(),t._v(" "),t.onlyTrashed?i("el-button",{attrs:{size:"small"},on:{click:t.checkRestore}},[t._v("选中还原")]):t._e(),t._v(" "),t.onlyTrashed?i("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleRestoreAll}},[t._v("全部还原")]):t._e(),t._v(" "),i("el-button",{attrs:{size:"small",type:"warning"},on:{click:t.handleDeleteAll}},[t._v("\n          "+t._s(t.onlyTrashed?"全部销毁":"全部删除")+"\n        ")])],1)],1)],1),t._v(" "),i("el-col",{staticClass:"list-after-action",staticStyle:{"padding-top":"12px","text-align":"right"},attrs:{span:24}},[t.list.total>0?i("el-pagination",{staticClass:"pagination",attrs:{"page-size":20,"page-sizes":[10,20,30,40,50,100],total:t.list.total,"current-page":t.list.current_page,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:currentPage":function(e){t.$set(t.list,"current_page",e)},"current-change":t.onChangePage,"size-change":t.onChangePageSize}}):t._e()],1),t._v(" "),t.editInfo?i("card-edit",{attrs:{info:t.editInfo},on:{close:t.editCallback}}):t._e()],1)},staticRenderFns:[]},f=i("VU/8")(u,p,!1,null,null,null),e.default=f.exports},nNMC:function(t,e,i){"use strict";var n,a,s;Object.defineProperty(e,"__esModule",{value:!0}),n={components:{cardList:i("5UwD").default}},a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("card-list",{attrs:{onlyTrashed:!0}})},staticRenderFns:[]},s=i("VU/8")(n,a,!1,null,null,null),e.default=s.exports}});