webpackJsonp([27],{VaEe:function(e,t,o){"use strict";var r,a,l,n,i,s,u,c,p,m;Object.defineProperty(t,"__esModule",{value:!0}),r=o("woOf"),a=o.n(r),l=o("Y81h"),n=o.n(l),i=o("4cjj"),s=o("s8Ph"),u=o("UgCr"),c={props:{inBox:{default:!1},userInfo:{}},data:function(){var e=new Date;return e.setTime(e.getTime()+6048e5),{loading:!1,labelWidth:this.$store.state.app.isMobile?"50px":"90px",couponType:i.c,couponDiscountType:i.a,categories:[],products:[],form:{category_id:-1,product_id:-1,type:i.c.TYPE_ONETIME,coupon:null,discount_val:"",discount_type:i.a.AMOUNT,count:null,expire_at:e},formRules:{discount_val:[{required:!0,message:"请输入优惠券面额",trigger:"blur"},{type:"number",min:.01,max:1e6,message:"数字需要在0.01-1000000之间"}]},list:[]}},watch:{loading:function(e,t){e?t||n.a.isStarted()||n.a.start():n.a.done()}},mounted:function(){this.getCategories(),this.userInfo&&(this.form.user_id=this.userInfo.id)},methods:{getCategories:function(){var e,t=this;this.categories=[],e={search:"simple",val:"list"},this.userInfo&&(e.user_id=this.userInfo.id),Object(s.c)(e).then(function(e){t.categories=e.data})},getProducts:function(e){var t,o=this;this.category_id_old!==e&&(this.category_id_old=e,this.products=[],t={search:"simple",val:e},this.userInfo&&(t.user_id=this.userInfo.id),Object(u.e)(t).then(function(e){o.products=e.data}))},onTypeChange:function(){},onDiscountTypeChange:function(){this.form.discount_type===i.a.AMOUNT?this.formRules.discount_val=[{required:!0,message:"请输入优惠券面额",trigger:"blur"},{type:"number",min:.01,max:1e7,message:"数字需要在0.01-10000000之间"}]:this.form.discount_type===i.a.PERCENT&&(this.formRules.discount_val=[{required:!0,message:"请输入优惠百分比",trigger:"blur"},{type:"number",min:1,max:100,message:"数字需要在1-100之间"}])},onSubmit:function(){var e=this;this.$refs.form.validate(function(t){if(t){e.list=[],e.loading=!0;var o=a()({},e.form);o.discount_type===i.a.AMOUNT&&(o.discount_val*=100),o.expire_at&&(o.expire_at=o.expire_at.format("yyyy-MM-dd")),Object(i.d)(o).then(function(t){e.loading=!1,e.list=t.data,e.$notify({title:"提示",message:"生成优惠券成功",type:"success",duration:3e3}),e.$emit("submit",!0)}).catch(function(){e.loading=!1})}})}}},p={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{class:{"app-container":!e.inBox}},[o("h3",{staticStyle:{margin:"4px 0 28px 0"}},[e._v("生成优惠券")]),e._v(" "),o("el-form",{ref:"form",attrs:{model:e.form,"label-width":e.labelWidth,rules:e.formRules}},[o("el-form-item",{attrs:{label:"类型"}},[o("el-radio-group",{attrs:{size:"small"},on:{change:e.onTypeChange},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[o("el-radio-button",{attrs:{label:e.couponType.TYPE_ONETIME}},[e._v("一次性")]),e._v(" "),o("el-radio-button",{attrs:{label:e.couponType.TYPE_REPEAT}},[e._v("重复使用")])],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"商品",prop:"product_id"}},[o("el-select",{attrs:{"no-data-text":"请先添加分类"},on:{change:e.getProducts},model:{value:e.form.category_id,callback:function(t){e.$set(e.form,"category_id",t)},expression:"form.category_id"}},[o("el-option",{attrs:{label:"全部",value:-1}}),e._v(" "),e._l(e.categories,function(e){return o("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})],2),e._v(" "),o("el-select",{model:{value:e.form.product_id,callback:function(t){e.$set(e.form,"product_id",t)},expression:"form.product_id"}},[o("el-option",{attrs:{label:"全部",value:-1}}),e._v(" "),e._l(e.products,function(e){return o("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})],2)],1),e._v(" "),o("el-form-item",{attrs:{label:"面额",prop:"discount_val"}},[o("el-input",{attrs:{type:"number",placeholder:"请输入优惠券面额"},model:{value:e.form.discount_val,callback:function(t){e.$set(e.form,"discount_val",e._n(t))},expression:"form.discount_val"}},[o("el-select",{staticStyle:{width:"70px"},attrs:{slot:"append",placeholder:"类型",value:"",size:"small"},on:{change:e.onDiscountTypeChange},slot:"append",model:{value:e.form.discount_type,callback:function(t){e.$set(e.form,"discount_type",t)},expression:"form.discount_type"}},[o("el-option",{attrs:{label:"￥",value:e.couponDiscountType.AMOUNT}}),e._v(" "),o("el-option",{attrs:{label:"%",value:e.couponDiscountType.PERCENT}})],1)],1)],1),e._v(" "),e.form.type===e.couponType.TYPE_REPEAT?o("el-form-item",{attrs:{label:"可用",prop:"count_all",rules:[{required:!0,message:"请输入可用次数",trigger:"blur"},{type:"number",min:1,max:1e7,message:"可用次数不能超过10000000"}]}},[o("el-input",{attrs:{type:"number",placeholder:"请输入可用次数"},model:{value:e.form.count_all,callback:function(t){e.$set(e.form,"count_all",e._n(t))},expression:"form.count_all"}})],1):e._e(),e._v(" "),e.form.type===e.couponType.TYPE_ONETIME?o("el-form-item",{attrs:{label:"数量",prop:"count",rules:[{required:!0,message:"请输入生成数量",trigger:"blur"},{type:"number",min:1,max:100,message:"每次生成不能大于100张"}]}},[o("el-input",{attrs:{type:"number",placeholder:"请输入生成数量"},model:{value:e.form.count,callback:function(t){e.$set(e.form,"count",e._n(t))},expression:"form.count"}})],1):e._e(),e._v(" "),e.form.type===e.couponType.TYPE_REPEAT?o("el-form-item",{attrs:{label:"券",prop:"coupon"}},[o("el-input",{attrs:{type:"text",placeholder:"为空系统自动生成"},model:{value:e.form.coupon,callback:function(t){e.$set(e.form,"coupon",t)},expression:"form.coupon"}})],1):e._e(),e._v(" "),o("el-form-item",{attrs:{label:"过期",prop:"expire_at"}},[o("el-date-picker",{attrs:{type:"datetime",placeholder:"选择过期时间"},model:{value:e.form.expire_at,callback:function(t){e.$set(e.form,"expire_at",t)},expression:"form.expire_at"}})],1),e._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v("添加")])],1)],1),e._v(" "),e.list.length?o("div",{staticStyle:{"font-size":"14px",color:"#606266","line-height":"16px","margin-top":"24px"},style:{"margin-left":e.labelWidth}},[o("span",[e._v("生成优惠券 "+e._s(e.list.length)+"张")]),e._v(" "),o("p",{domProps:{innerHTML:e._s(e.list.join("<br>"))}})]):e._e()],1)},staticRenderFns:[]},m=o("VU/8")(c,p,!1,null,null,null),t.default=m.exports}});